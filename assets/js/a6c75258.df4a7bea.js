"use strict";(self.webpackChunkmirage_docs=self.webpackChunkmirage_docs||[]).push([[7312],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>u});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),c=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},y=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),y=c(t),u=r,h=y["".concat(s,".").concat(u)]||y[u]||d[u]||o;return t?a.createElement(h,i(i({ref:n},p),{},{components:t})):a.createElement(h,i({ref:n},p))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=y;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}y.displayName="MDXCreateElement"},64685:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=t(87462),r=(t(67294),t(3905));const o={sidebar_position:2},i="Sync Var",l={unversionedId:"guides/sync/sync-var",id:"guides/sync/sync-var",title:"Sync Var",description:"SyncVars are properties of classes that inherit from NetworkBehaviour, which are synchronized from the server to clients. When a game object is spawned, or a new player joins a game in progress, they are sent the latest state of all SyncVars on networked objects that are visible to them. Use the [SyncVar] custom attribute to specify which variables in your script you want to synchronize.",source:"@site/docs/guides/sync/sync-var.md",sourceDirName:"guides/sync",slug:"/guides/sync/sync-var",permalink:"/Mirage/docs/guides/sync/sync-var",draft:!1,editUrl:"https://github.com/MirageNet/Mirage/tree/main/doc/docs/guides/sync/sync-var.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docs",previous:{title:"State Synchronization",permalink:"/Mirage/docs/guides/sync/"},next:{title:"Sync Var Hooks",permalink:"/Mirage/docs/guides/sync/sync-var-hooks"}},s={},c=[{value:"Example",id:"example",level:2},{value:"Class inheritance",id:"class-inheritance",level:2},{value:"SyncVar hook",id:"syncvar-hook",level:2},{value:"Example Client Only",id:"example-client-only",level:3},{value:"Example Client &amp; Server",id:"example-client--server",level:3},{value:"SyncVar Initialize Only",id:"syncvar-initialize-only",level:2},{value:"Example",id:"example-1",level:3}],p={toc:c};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sync-var"},"Sync Var"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/SyncVarAttribute"},(0,r.kt)("inlineCode",{parentName:"a"},"SyncVars"))," are properties of classes that inherit from ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/NetworkBehaviour"},"NetworkBehaviour"),", which are synchronized from the server to clients. When a game object is spawned, or a new player joins a game in progress, they are sent the latest state of all SyncVars on networked objects that are visible to them. Use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/SyncVarAttribute"},"[SyncVar]")," custom attribute to specify which variables in your script you want to synchronize."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The state of SyncVars is applied to game objects on clients before ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/NetworkIdentity#onstartclient"},"Identity.OnStartClient")," event is invoked, so the state of the object is always up-to-date in subscribed callbacks.")),(0,r.kt)("p",null,"SyncVars can use any ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/serialization/data-types"},"type supported by Mirage"),". You can have up to 64 SyncVars on a single NetworkBehaviour script, including ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/sync/sync-objects/sync-list"},"SyncLists")," and other sync types."),(0,r.kt)("p",null,"The server automatically sends SyncVar updates when the value of a SyncVar changes, so you do not need to track when they change or send information about the changes yourself. Changing a value in the inspector will not trigger an update."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"SyncVars are not sent right away or in the order they are set. They will be sent as a group in the next sync update.")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"Let's have a simple ",(0,r.kt)("inlineCode",{parentName:"p"},"Player")," class with the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"using Mirage;\nusing UnityEngine;\n\npublic class Player : NetworkBehaviour\n{\n    [SyncVar]\n    public int clickCount;\n\n    private void Update()\n    {\n        if (IsLocalPlayer && Input.GetMouseButtonDown(0))\n        {\n            ServerRpc_IncreaseClicks();\n        }\n    }\n\n    [ServerRpc]\n    public void ServerRpc_IncreaseClicks()\n    {\n        // This is executed on the server\n        clickCount++;\n    }\n}\n")),(0,r.kt)("p",null,"In this example, when Player A clicks the left mouse button, he sends a ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/remote-actions/server-rpc"},"ServerRpc")," to the server where the ",(0,r.kt)("inlineCode",{parentName:"p"},"clickCount")," SyncVar is incremented. All other visible players will be informed about Player A's new ",(0,r.kt)("inlineCode",{parentName:"p"},"clickCount")," value."),(0,r.kt)("h2",{id:"class-inheritance"},"Class inheritance"),(0,r.kt)("p",null,"SyncVars work with class inheritance. Consider this example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"private class Pet : NetworkBehaviour\n{\n    [SyncVar] \n    private string name;\n}\n\nprivate class Cat : Pet\n{\n    [SyncVar]\n    private Color32 color;\n}\n")),(0,r.kt)("p",null,"You can attach the Cat component to your cat prefab, and it will synchronize both its ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"color"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Both ",(0,r.kt)("inlineCode",{parentName:"p"},"Cat")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Pet")," should be in the same assembly. If they are in separate assemblies, make sure not to change ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," from inside ",(0,r.kt)("inlineCode",{parentName:"p"},"Cat")," directly, add a method to ",(0,r.kt)("inlineCode",{parentName:"p"},"Pet")," instead. ")),(0,r.kt)("h2",{id:"syncvar-hook"},"SyncVar hook"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"hook")," option of SyncVar attribute can be used to specify a function to be called when the SyncVar changes value on the client and server."),(0,r.kt)("p",null,"For more information on SyncVar hooks see ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/sync/sync-var-hooks"},"Sync Var Hooks")),(0,r.kt)("h3",{id:"example-client-only"},"Example Client Only"),(0,r.kt)("p",null,"Below is a simple example of assigning a random color to each player when they're spawned on the server.  All clients will see all players in the correct colors, even if they join later."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"using UnityEngine;\nusing Mirage;\n\npublic class Player : NetworkBehaviour\n{\n    [SyncVar(hook = nameof(UpdateColor))]\n    private Color playerColor = Color.black;\n\n    private Renderer renderer;\n\n    // Unity makes a clone of the Material every time renderer.material is used.\n    // Cache it here and Destroy it in OnDestroy to prevent a memory leak.\n    private Material cachedMaterial;\n\n    private void Awake()\n    {\n        renderer = GetComponent<Renderer>();\n        Identity.OnStartServer.AddListener(OnStartServer);\n    }\n\n    private void OnStartServer()\n    {\n        playerColor = Random.ColorHSV(0f, 1f, 1f, 1f, 0.5f, 1f);\n    }\n\n    private void UpdateColor(Color oldColor, Color newColor)\n    {\n        // this is executed on this player for each client\n        if (cachedMaterial == null)\n        {\n            cachedMaterial = renderer.material;\n        }\n\n        cachedMaterial.color = newColor;\n    }\n\n    private void OnDestroy()\n    {\n        Destroy(cachedMaterial);\n    }\n}\n")),(0,r.kt)("h3",{id:"example-client--server"},"Example Client & Server"),(0,r.kt)("p",null,"Below is a simple example of assigning a random color to each player when they're spawned on the server. All clients will see all players in the correct colors, even if they join later, the server will also fire the event."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"using UnityEngine;\nusing Mirage;\n\npublic class Player : NetworkBehaviour\n{\n    [SyncVar(hook = nameof(UpdateColor), invokeHookOnServer = true)]\n    private Color playerColor = Color.black;\n\n    private Renderer renderer;\n\n    // Unity makes a clone of the Material every time renderer.material is used.\n    // Cache it here and Destroy it in OnDestroy to prevent a memory leak.\n    private Material cachedMaterial;\n\n    private void Awake()\n    {\n        renderer = GetComponent<Renderer>();\n        Identity.OnStartServer.AddListener(OnStartServer);\n    }\n\n    private void OnStartServer()\n    {\n        playerColor = Random.ColorHSV(0f, 1f, 1f, 1f, 0.5f, 1f);\n    }\n\n    private void UpdateColor(Color oldColor, Color newColor)\n    {\n        // this is executed on this player for each client\n        if (cachedMaterial == null)\n        {\n            cachedMaterial = renderer.material;\n        }\n\n        cachedMaterial.color = newColor;\n    }\n\n    private void OnDestroy()\n    {\n        Destroy(cachedMaterial);\n    }\n}\n")),(0,r.kt)("h2",{id:"syncvar-initialize-only"},"SyncVar Initialize Only"),(0,r.kt)("p",null,"Just like regular SyncVars, when a game object is spawned, or a new player joins a game in progress, they are sent the latest state of all SyncVars on networked objects that are visible to them.\nWith the ",(0,r.kt)("inlineCode",{parentName:"p"},"initialOnly")," flag set to true you will now be able to control the state of the SyncVar manually rather than waiting for Mirage to update them. "),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Make sure you manually update your observable clients with the new state.",(0,r.kt)("br",{parentName:"p"}),"\n","Syncvar Hooks become redundant, as you are setting the state of the Syncvar directly.")),(0,r.kt)("h3",{id:"example-1"},"Example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"using Mirage;\nusing UnityEngine;\n\npublic class Player : NetworkBehaviour\n{\n    [SyncVar(initialOnly = true)]\n    private int weaponId;\n\n    private void Awake()\n    {\n        Identity.OnStartClient.AddListener(OnStartClient);\n    }\n\n    private void OnStartClient()\n    {\n        // Update weapon using id from syncvar (sent to client via spawn message\n        UpdateWeapon(weaponId);\n    }\n\n    private void Update()\n    {\n        if (Input.GetKeyDown(KeyCode.Q))\n        {\n            // Client Request weapon change\n            ServerRpc_SetSyncVarWeaponId(7);\n        }\n    }\n\n    [ServerRpc]\n    private void ServerRpc_SetSyncVarWeaponId(int weaponId)\n    {\n        // Set weapon id on server so new players get it\n        this.weaponId = weaponId;\n\n        // Tell current players about it\n        ClientRpc_SetSyncVarWeaponId(weaponId);\n\n        // Update weapon on server\n        UpdateWeapon(weaponId);\n    }\n\n    [ClientRpc]\n    private void ClientRpc_SetSyncVarWeaponId(int weaponId)\n    {\n        // Set id on client\n        this.weaponId = weaponId;\n\n        // Update weapon on client\n        UpdateWeapon(weaponId);\n    }\n\n    public void UpdateWeapon(int weaponId)\n    {\n        // Do stuff to update weapon here\n        // For example, its spawning model\n    }\n}\n")))}d.isMDXComponent=!0}}]);