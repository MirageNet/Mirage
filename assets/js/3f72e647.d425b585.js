"use strict";(self.webpackChunkmirage_docs=self.webpackChunkmirage_docs||[]).push([[2501],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=a.createContext({}),p=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,u=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=p(n),m=r,k=d["".concat(u,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(k,l(l({ref:t},s),{},{components:n})):a.createElement(k,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=d;var o={};for(var u in t)hasOwnProperty.call(t,u)&&(o[u]=t[u]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},32386:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const i={},l="Bit Count",o={unversionedId:"guides/bit-packing/bit-count",id:"guides/bit-packing/bit-count",title:"Bit Count",description:"The bit count of Integer based fields can be set using the BitCountAttribute.",source:"@site/docs/guides/bit-packing/bit-count.md",sourceDirName:"guides/bit-packing",slug:"/guides/bit-packing/bit-count",permalink:"/Mirage/docs/guides/bit-packing/bit-count",draft:!1,editUrl:"https://github.com/MirageNet/Mirage/tree/main/doc/docs/guides/bit-packing/bit-count.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Bit Count From Range",permalink:"/Mirage/docs/guides/bit-packing/bit-count-from-range"},next:{title:"Float Pack",permalink:"/Mirage/docs/guides/bit-packing/float-pack"}},u={},p=[{value:"Use cases",id:"use-cases",level:3},{value:"Supported Types",id:"supported-types",level:3},{value:"Example 1",id:"example-1",level:3},{value:"Example 2",id:"example-2",level:3},{value:"Generated Code",id:"generated-code",level:3}],s={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"bit-count"},"Bit Count"),(0,r.kt)("p",null,"The bit count of Integer based fields can be set using the ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage.Serialization/BitCountAttribute"},"BitCountAttribute"),"."),(0,r.kt)("p",null,"This will truncate the bits so that only the small bits are sent. There is no range checking for values using BitCount, so the value that is too big or negative will not be unpacked correctly"),(0,r.kt)("p",null,"This means that ",(0,r.kt)("inlineCode",{parentName:"p"},"BitCount")," should not be used with values that can be negative because this data will be lost. If you do need to send negative values then use ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/bit-packing/zig-zag-encode"},"ZigZagEncode")," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/guides/bit-packing/bit-count-from-range"},"BitCountFromRange")),(0,r.kt)("h3",{id:"use-cases"},"Use cases"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A Value with a maximum value"),(0,r.kt)("li",{parentName:"ul"},"An index in an array of known size",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"eg array with 10 elements, the index can be sent as 4 bits"))),(0,r.kt)("li",{parentName:"ul"},"A Random int hash where you only need to send 16 bits")),(0,r.kt)("h3",{id:"supported-types"},"Supported Types"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Byte"),(0,r.kt)("li",{parentName:"ul"},"Short"),(0,r.kt)("li",{parentName:"ul"},"UShort"),(0,r.kt)("li",{parentName:"ul"},"Int"),(0,r.kt)("li",{parentName:"ul"},"Uint"),(0,r.kt)("li",{parentName:"ul"},"Long"),(0,r.kt)("li",{parentName:"ul"},"ULong"),(0,r.kt)("li",{parentName:"ul"},"Enum")),(0,r.kt)("h3",{id:"example-1"},"Example 1"),(0,r.kt)("p",null,"Health which is between 0 and 100"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"public class MyNetworkBehaviour : NetworkBehaviour \n{\n    [SyncVar, BitCount(7)]\n    public int Health;\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"BitCount = 7")," so max value of Health is ",(0,r.kt)("inlineCode",{parentName:"p"},"127")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"health = 57")," will serialize to ",(0,r.kt)("inlineCode",{parentName:"p"},"011_1001")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"health = -1")," ",(0,r.kt)("em",{parentName:"p"},"(out of range)")," will serialize to ",(0,r.kt)("inlineCode",{parentName:"p"},"111_1111")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"health = 130")," ",(0,r.kt)("em",{parentName:"p"},"(out of range)")," will serialize to ",(0,r.kt)("inlineCode",{parentName:"p"},"000_0010")),(0,r.kt)("h3",{id:"example-2"},"Example 2"),(0,r.kt)("p",null,"Weapon index in a list of 6 weapons"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"public class MyNetworkBehaviour : NetworkBehaviour \n{\n    [SyncVar, BitCount(3)]\n    public int WeaponIndex;\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"BitCount = 3")," so max value of Health is 7"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"WeaponIndex = 5")," will serialize to ",(0,r.kt)("inlineCode",{parentName:"p"},"101")),(0,r.kt)("h3",{id:"generated-code"},"Generated Code"),(0,r.kt)("p",null,"Source:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"[SyncVar, BitCount(7)]\npublic int myValue;\n")),(0,r.kt)("p",null,"Generated:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"public override bool SerializeSyncVars(NetworkWriter writer, bool initialState)\n{\n    ulong syncVarDirtyBits = base.SyncVarDirtyBits;\n    bool result = base.SerializeSyncVars(writer, initialize);\n\n    if (initialState) \n    {\n        writer.Write((ulong)this.myValue, 7);\n        return true;\n    }\n\n    writer.Write(syncVarDirtyBits, 1);\n    if ((syncVarDirtyBits & 1UL) != 0UL)\n    {\n        writer.Write((ulong)this.myValue, 7);\n        result = true;\n    }\n\n    return result;\n}\n\npublic override void DeserializeSyncVars(NetworkReader reader, bool initialState)\n{\n    base.DeserializeSyncVars(reader, initialState);\n\n    if (initialState)\n    {\n        this.myValue = reader.Read(7);\n        return;\n    }\n\n    ulong dirtyMask = reader.Read(1);\n    if ((dirtyMask & 1UL) != 0UL)\n    {\n        this.myValue = reader.Read(7);\n    }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Last updated for Mirage v101.8.0.")))}c.isMDXComponent=!0}}]);