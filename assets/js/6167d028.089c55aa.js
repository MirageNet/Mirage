"use strict";(self.webpackChunkmirage_docs=self.webpackChunkmirage_docs||[]).push([[22],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),d=u(a),m=r,k=d["".concat(s,".").concat(m)]||d[m]||p[m]||l;return a?n.createElement(k,i(i({ref:t},c),{},{components:a})):n.createElement(k,i({ref:t},c))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},86255:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var n=a(87462),r=(a(67294),a(3905));const l={sidebar_position:1,title:"Network Behaviour"},i="Network Behaviour Callbacks",o={unversionedId:"guides/callbacks/network-behaviour",id:"guides/callbacks/network-behaviour",title:"Network Behaviour",description:"See also NetworkBehaviour in the API Reference.",source:"@site/docs/guides/callbacks/network-behaviour.md",sourceDirName:"guides/callbacks",slug:"/guides/callbacks/network-behaviour",permalink:"/Mirage/docs/guides/callbacks/network-behaviour",draft:!1,editUrl:"https://github.com/MirageNet/Mirage/tree/main/doc/docs/guides/callbacks/network-behaviour.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Network Behaviour"},sidebar:"docs",previous:{title:"Callbacks Overview",permalink:"/Mirage/docs/guides/callbacks/"},next:{title:"Network Manager",permalink:"/Mirage/docs/guides/callbacks/network-manager"}},s={},u=[{value:"Server Only",id:"server-only",level:2},{value:"Client only",id:"client-only",level:2},{value:"Server mode",id:"server-mode",level:3},{value:"Client mode",id:"client-mode",level:3},{value:"Host mode",id:"host-mode",level:3}],c={toc:u};function p(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"network-behaviour-callbacks"},"Network Behaviour Callbacks"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"See also ",(0,r.kt)("a",{parentName:"strong",href:"/docs/reference/Mirage/NetworkBehaviour"},"NetworkBehaviour")," in the API Reference.")),(0,r.kt)("p",null,"There are a number of events relating to network behaviours that can occur over the course of a normal multiplayer game. These include events such as the host starting up, a player joining, or a player leaving. Each of these possible events has an associated callback that you can implement in your own code to take action when the event occurs."),(0,r.kt)("p",null,"To use an event you must add a function as a listener, this function will then be called when the event occurs. Some events, like ",(0,r.kt)("inlineCode",{parentName:"p"},"OnStartServer"),", will call the listener immediately if the event was previously called. This allows you to add the listeners at any point without worrying about missing the Invoke."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cs"},"void Awake()\n{\n    Identity.OnStartServer.AddListener(MyStartServer);\n    Identity.OnStartClient.AddListener(MyStartClient);\n    Identity.OnStartLocalPlayer.AddListener(MyStartLocalPlayer);\n}\n\nvoid MyStartServer() \n{\n    // ...\n}\n\nvoid MyStartClient() \n{\n    // ...\n}\n\nvoid MyStartLocalPlayer() \n{\n    // ...\n}\n")),(0,r.kt)("p",null,"This is a full list of virtual methods (callbacks) that you can implement on ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkBehaviour"),", and where they are called"),(0,r.kt)("h2",{id:"server-only"},"Server Only"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"OnStartServer",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when behaviour is spawned on the server"))),(0,r.kt)("li",{parentName:"ul"},"OnStopServer",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when behaviour is destroyed or unspawned on the server"))),(0,r.kt)("li",{parentName:"ul"},"OnSerialize",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when behaviour is serializing before it is sent to a client, when overriding make sure to call ",(0,r.kt)("inlineCode",{parentName:"li"},"base.OnSerialize"))))),(0,r.kt)("h2",{id:"client-only"},"Client only"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"OnStartClient"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when behaviour is spawned on a client "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"OnStartAuthority"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when behaviour has authority when it is spawned (eg local player)"),(0,r.kt)("li",{parentName:"ul"},"called when behaviour is given authority by the sever"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"OnStartLocalPlayer"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when the behaviour is on the local character object"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"OnStopAuthority"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when authority is taken from the object (eg local player is replaced but not destroyed)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"OnStopClient"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"called when an object is destroyed on a client by the ",(0,r.kt)("inlineCode",{parentName:"li"},"ObjectDestroyMessage")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"ObjectHideMessage")," messages")))),(0,r.kt)("h1",{id:"example-flows"},"Example flows"),(0,r.kt)("p",null,"Below is some example call order for different modes"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"Start")," is called by Unity before the first frame, while normally this happens after Mirage's callbacks. But if you don't call ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkServer.Spawn")," the same frame as ",(0,r.kt)("inlineCode",{parentName:"p"},"Instantiate")," then start may be called first")),(0,r.kt)("h3",{id:"server-mode"},"Server mode"),(0,r.kt)("p",null,"When ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkServer.Spawn")," is called (eg when new client connections and a player is created)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartServer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnRebuildObservers")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Start"))),(0,r.kt)("h3",{id:"client-mode"},"Client mode"),(0,r.kt)("p",null,"When the local player is spawned for the client"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartAuthority")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartClient")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartLocalPlayer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Start"))),(0,r.kt)("h3",{id:"host-mode"},"Host mode"),(0,r.kt)("p",null,"These are only called on the ",(0,r.kt)("strong",{parentName:"p"},"Player Game Objects")," when a client connects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartServer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnRebuildObservers")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartAuthority")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartClient")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnSetHostVisibility")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"OnStartLocalPlayer")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Start"))))}p.isMDXComponent=!0}}]);