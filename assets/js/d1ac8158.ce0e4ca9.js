"use strict";(self.webpackChunkmirage_docs=self.webpackChunkmirage_docs||[]).push([[5328],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>u});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),l=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},b=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=l(n),u=r,h=b["".concat(o,".").concat(u)]||b[u]||d[u]||i;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=b;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var l=2;l<i;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},9373:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var a=n(87462),r=(n(67294),n(3905));const i={sidebar_position:8,title:"Scene Objects"},s="Scene Game Objects",c={unversionedId:"guides/game-objects/scene-objects",id:"guides/game-objects/scene-objects",title:"Scene Objects",description:"There are two types of networked game objects in Mirage\u2019s multiplayer system:",source:"@site/docs/guides/game-objects/scene-objects.md",sourceDirName:"guides/game-objects",slug:"/guides/game-objects/scene-objects",permalink:"/Mirage/docs/guides/game-objects/scene-objects",draft:!1,editUrl:"https://github.com/MirageNet/Mirage/tree/main/doc/docs/guides/game-objects/scene-objects.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,title:"Scene Objects"},sidebar:"docs",previous:{title:"Spawn Object - Pooling",permalink:"/Mirage/docs/guides/game-objects/spawn-object-pooling"},next:{title:"Pickups, Drops, and Child Objects",permalink:"/Mirage/docs/guides/game-objects/pickup-drop-child"}},o={},l=[{value:"Filtering Scene Objects",id:"filtering-scene-objects",level:3}],p={toc:l};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"scene-game-objects"},"Scene Game Objects"),(0,r.kt)("p",null,"There are two types of networked game objects in Mirage\u2019s multiplayer system:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Those that are spawned from prefabs at runtime"),(0,r.kt)("li",{parentName:"ul"},"Those that are saved as part of a Scene")),(0,r.kt)("p",null,"Game objects that are spawned from prefabs at runtime must have their prefabs registered in the ClientObjectManager and are instantiated on client when they are spawned on the server. See ",(0,r.kt)("a",{parentName:"p",href:"/Mirage/docs/guides/game-objects/spawn-object"},"Spawn objects")," for more on spawning from prefabs."),(0,r.kt)("p",null,"Networked game objects that you save as part of a Scene are handled differently, as they already exist in the Scene when it is loaded. After loading a new scene ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/ClientObjectManager#preparetospawnsceneobjects"},"PrepareToSpawnSceneObjects")," must be called on the client and ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/ServerObjectManager#spawnsceneobjects"},"SpawnSceneObjects")," on the server. These functions will cause Mirage to find all scene objects and then spawn them for networking. These objects will then have their netId and other network values set once the server has send the SpawnMessage for that object. You may want to disable scene objects to avoid them being in the scene until they are spawned.  "),(0,r.kt)("p",null,"Saving networked game objects in your Scene has some benefits:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"They are loaded with the level"),(0,r.kt)("li",{parentName:"ul"},"They can be modify in the scene, rather than requiring multiple prefabs for small changes"),(0,r.kt)("li",{parentName:"ul"},"Other game object instances in the Scene can reference them, which can avoid you having to use code to find the game objects and make references to them up at runtime.")),(0,r.kt)("p",null,"Networked scene objects are spawned by the ClientObjectManager and ServerObjectManager and act like any other dynamically spawned game objects. Mirage synchronizes them with updates ClientRPC calls."),(0,r.kt)("p",null,"If a Scene game object is destroyed on the server before a client joins the game, then it is never spawned on new clients. It will be left in the state it is when you were editing the scene."),(0,r.kt)("p",null,"After a client has connected and you have called ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/ServerObjectManager#addcharacterinetworkplayer-networkidentity"},"AddCharacter")," or ",(0,r.kt)("a",{parentName:"p",href:"/docs/reference/Mirage/ServerObjectManager#spawnvisibleobjectsinetworkplayer-boolean"},"SpawnVisibleObjects"),", the client is sent a spawn message for each of the Scene objects that exist on the server, that are visible to that client. This message causes the game object on the client to be enabled and has the latest state of that game object from the server in it. This means that only game objects that are visible to the client and not destroyed on the server, are spawned on the client. Like regular non-Scene objects, these Scene objects are started with the latest state when the client joins the game."),(0,r.kt)("h3",{id:"filtering-scene-objects"},"Filtering Scene Objects"),(0,r.kt)("p",null,"By default, calling ",(0,r.kt)("inlineCode",{parentName:"p"},"SpawnSceneObjects")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"PrepareToSpawnSceneObjects")," will cause Mirage to find all ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkIdentity")," components in all loaded scenes using ",(0,r.kt)("inlineCode",{parentName:"p"},"Resources.FindObjectsOfTypeAll<NetworkIdentity>()"),"."),(0,r.kt)("p",null,"In some cases, like when running multiple server or client instances in the same unity process, this can be problematic as it might find objects from scenes that don't belong to the current instance."),(0,r.kt)("p",null,"To solve this, you can provide a custom filter by setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"SceneObjectFilter")," property on the ",(0,r.kt)("inlineCode",{parentName:"p"},"ServerObjectManager")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ClientObjectManager"),". This allows you to control exactly which ",(0,r.kt)("inlineCode",{parentName:"p"},"NetworkIdentity")," components are included. If the filter is left ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),", the default behavior is used."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example: Only include objects from a specific scene")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-csharp"},"using Mirage;\nusing UnityEngine;\nusing UnityEngine.SceneManagement;\n\npublic class MySceneManager : MonoBehaviour\n{\n    public ServerObjectManager serverObjectManager;\n    public ClientObjectManager clientObjectManager;\n    public Scene myScene;\n\n    // Set the scene to use for filtering\n    public void SetScene(Scene scene) \n    {\n        myScene = scene;\n    }\n\n    void Awake()\n    {\n        // Set the filter before spawning scene objects\n        var filter = (NetworkIdentity identity) =>\n        {\n            return identity.gameObject.scene == myScene;\n        };\n\n        serverObjectManager.SceneObjectFilter = filter;\n        clientObjectManager.SceneObjectFilter = filter;\n\n        // Now when SpawnSceneObjects is called, it will only\n        // consider objects from `myScene`.\n        serverObjectManager.SpawnSceneObjects();\n    }\n}\n")))}d.isMDXComponent=!0}}]);