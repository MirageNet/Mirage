"use strict";(self.webpackChunkmirage_docs=self.webpackChunkmirage_docs||[]).push([[6215],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(r),m=a,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return r?n.createElement(h,i(i({ref:t},u),{},{components:r})):n.createElement(h,i({ref:t},u))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},96472:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=r(87462),a=(r(67294),r(3905));const o={sidebar_position:3},i="Server RPC",s={unversionedId:"guides/remote-actions/server-rpc",id:"guides/remote-actions/server-rpc",title:"Server RPC",description:"Server RPC Calls are sent from character objects on the client to character objects on the server. For security, Server RPC Calls can only be sent from YOUR character object by default, so you cannot control the objects of other players. You can bypass the authority check using [ServerRpc(requireAuthority = false)].",source:"@site/docs/guides/remote-actions/server-rpc.md",sourceDirName:"guides/remote-actions",slug:"/guides/remote-actions/server-rpc",permalink:"/Mirage/docs/guides/remote-actions/server-rpc",draft:!1,editUrl:"https://github.com/MirageNet/Mirage/tree/main/doc/docs/guides/remote-actions/server-rpc.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docs",previous:{title:"Client RPC",permalink:"/Mirage/docs/guides/remote-actions/client-rpc"},next:{title:"Network Messages",permalink:"/Mirage/docs/guides/remote-actions/network-messages"}},c={},l=[{value:"Returning values",id:"returning-values",level:3},{value:"ServerRpc and Authority",id:"serverrpc-and-authority",level:3}],u={toc:l};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"server-rpc"},"Server RPC"),(0,a.kt)("p",null,"Server RPC Calls are sent from character objects on the client to character objects on the server. For security, Server RPC Calls can only be sent from YOUR character object by default, so you cannot control the objects of other players. You can bypass the authority check using ",(0,a.kt)("inlineCode",{parentName:"p"},"[ServerRpc(requireAuthority = false)]"),"."),(0,a.kt)("p",null,"To make a function into a Server RPC call, add the ","[ServerRpc]"," custom attribute to it. This function will now be run on the server when it is called on the client. Any parameters of the ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/serialization/data-types"},"allowed data types")," will be automatically passed to the server with the Server RPC Call."),(0,a.kt)("p",null,"Server RPC Calls functions cannot be static. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"public class Player : NetworkBehaviour\n{\n    // Assigned in inspector\n    public GameObject cubePrefab;\n\n    private void Update()\n    {\n        if (!IsLocalPlayer) \n        {\n            return;\n        }\n\n        if (Input.GetKey(KeyCode.X))\n        {\n            DropCube();\n        }\n    }\n\n    [ServerRpc]\n    private void DropCube()\n    {\n        if (cubePrefab != null)\n        {\n            Vector3 spawnPos = transform.position + transform.forward * 2;\n            Quaternion spawnRot = transform.rotation;\n            GameObject cube = Instantiate(cubePrefab, spawnPos, spawnRot);\n            NetworkServer.Spawn(cube);\n        }\n    }\n}\n")),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Be careful of sending ServerRpcs from the client every frame! This can cause a lot of network traffic.")),(0,a.kt)("h3",{id:"returning-values"},"Returning values"),(0,a.kt)("p",null,"ServerRpcs can return values. It can take a long time for the server to reply, so they must return a UniTask which the client can await.\nTo return a value, add a return value using ",(0,a.kt)("inlineCode",{parentName:"p"},"UniTask<MyReturnType>")," where ",(0,a.kt)("inlineCode",{parentName:"p"},"MyReturnType")," is any ",(0,a.kt)("a",{parentName:"p",href:"/docs/guides/serialization/data-types"},"supported Mirage type"),". In the server, you can make your method async,  or you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"UniTask.FromResult(myResult);"),". For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},'public class Shop : NetworkBehaviour\n {\n     [ServerRpc]\n     public UniTask<int> GetPrice(string item)\n     {\n         // do some loop up to get the price of some item\n         // this can be from a database, or settings file or whatever\n         switch (item)\n         {\n             case "turnip":\n                 return UniTask.FromResult(10);\n             case "apple":\n                 return UniTask.FromResult(3);\n             default:\n                 return UniTask.FromResult(int.MaxValue);\n         }\n     }\n\n     [Client]\n     public async UniTaskVoid DisplayTurnipPrice()\n     {\n         // Call the RPC and wait for the response without blocking the main thread\n         var price = await GetPrice("turnip");\n         Debug.Log($"Turnips price {price}");\n     }\n }\n')),(0,a.kt)("h3",{id:"serverrpc-and-authority"},"ServerRpc and Authority"),(0,a.kt)("p",null,"It is possible to invoke ServerRpcs on non-character objects if any of the following are true:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The object was spawned with client authority"),(0,a.kt)("li",{parentName:"ul"},"The object has client authority set with ",(0,a.kt)("inlineCode",{parentName:"li"},"NetworkIdentity.AssignClientAuthority")),(0,a.kt)("li",{parentName:"ul"},"the Server RPC Call has the ",(0,a.kt)("inlineCode",{parentName:"li"},"requireAuthority")," option set false.  ",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"You can include an optional ",(0,a.kt)("inlineCode",{parentName:"li"},"INetworkPlayer sender = null")," parameter in the Server RPC Call method signature and Mirage will fill in the sending client for you."),(0,a.kt)("li",{parentName:"ul"},"Do not try to set a value for this optional parameter...it will be ignored.")))),(0,a.kt)("p",null,"Server RPC Calls sent from these objects are run on the server instance of the object, not on the associated character object for the client."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cs"},"public enum DoorState : byte\n{\n    Open, Closed\n}\n\npublic class Door : NetworkBehaviour\n{\n    [SyncVar]\n    public DoorState doorState;\n\n    [ServerRpc(requireAuthority = false)]\n    public void CmdSetDoorState(DoorState newDoorState, INetworkPlayer sender = null)\n    {\n        if (sender.identity.GetComponent<Player>().hasDoorKey)\n        {\n            doorState = newDoorState;\n        }\n    }\n}\n")))}p.isMDXComponent=!0}}]);